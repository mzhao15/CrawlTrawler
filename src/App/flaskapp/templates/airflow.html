{% extends "layout.html" %}
{% block content %}
<div class="row">
    <div class="col-md-4">
        <div id="status" class="content-section">
            <h4 class="spacer">Search Airflow job status</h4>
            <form id="dagstatus">
                <div class="float-left">
                    <div class="form-group">
                        <label for="dagdate">Select a date:</label>
              		    <input id="dagdate" type="date" class="form-control" placeholder="2016-01-01" value="2016-01-01">
          		    </div>
                    <div class="form-group">
                        <label for="taskname">Select a task:</label>
                        <select id="taskname" class="form-control">
                            <option>finding</option>
                            <option>counting</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="output">Airflow task status</label>
                        <textarea id="output" class="form-control" type="text" rows="2"></textarea>
                    </div>
                    <button type="button" id="submit" class="btn btn-success">Search</button>
          		</div>
      		</form>
        </div>
    </div>
	<div class="col-md-8">
        <h3 id='airflow' class="text-center spacer">Airflow Job Example</h3>
        <div class="text-center">
            <p class="text-left">Airflow DAG is running on a daily basis. Each DAG consists of two taks:</p>
            <ul class="text-left">
                <li>identifying the web crawler IPs;</li>
                <li>filtering the detected web crawler IPs and calculate the statistics of user activities.</li>
            </ul>
            <img style="max-width:150px;" src="../static/images/daily_graph_view.png" alt="dag_graph_view">
            <h6 class="text-left spacer">Below shows the completed jobs in past days and running jobs. Different colors indicate different statuses of each task.</h6>
            <img style="max-width:300px;" src="../static/images/legend.png" alt="dag_tree_view_legend">
            <img style="max-width:400px;" src="../static/images/daily_tree_view.png" alt="dag_tree_view">
        </div>
        <!-- <script type="text/javascript">
        function call_status(){
             // var ran = Math.random();
             // jQuery('#status').html(ran);
             var dagid = "mybatch_scheduler";
             var taskid = "finding_2016-04-16";
             var airflowAPI = "http://ec2-18-235-119-208.compute-1.amazonaws.com:8081/api/experimental/dags/mybatch_scheduler/tasks/finding_2016-04-01";
             $.ajax({
                url: airflowAPI,
                dataType: "json",
                success: function(msg) {
                    console.log('Successfully connect to the dag');
                    jQuery('#status').html(msg);
                },
                error: function(e){
                   console.log('Failed to connect to the dag');
                }
            });
        }

        window.setInterval(function(){
               /// call your function here
              call_status();
        }, 6*1000);
        </script> -->
	</div>

	<div class="col-md-2"></div>
</div>
<script src="../static/js/airflow.js"></script>
{% endblock content %}
